# READ ME IF YOU CAN
import requests
import base64
import io
from PIL import Image
import pytesseract
import cv2
from captcha_solver import CaptchaSolver

url = "https://ringzer0ctf.com/challenges/17"
sessId = "npaedqk7ip8iiu26d5j3sfdc67"

def extractData():
	r = requests.get(url, cookies={"PHPSESSID":sessId})
	raw = r.text
	begin = raw.find("image/png;base64")+17
	img = raw[begin:].split('"')[0]
	img = base64.b64decode(img)
	with open('b64img.png', 'wb') as f:
		f.write(img)
	return 'b64img.png'

def solveCaptcha(img):
	image = cv2.imread(img)
	gray = cv2.cvtColor(image, cv2.COLOR_BGR2GRAY)
	solver = CaptchaSolver('browser')
	print(solver.solve_captcha(gray))


if '__main__' in __name__:
	img = extractData()
	solvedString = solveCaptcha(img)
	print(solvedString)
